%[text] # Final Project - Gravity Between a Solid and a Point Mass
%[text] ## Introduction
%[text] Welcome to your final project topic focusing on gravitational attraction! As before with all instances of using integration in applications, we will:
%[text] - first introduce the basic model for the phenomenon (gravity),  
%[text] - discuss why variation in some aspect of the phenomenon forces us to not use the basic model
%[text] - break up the objects involved into many small pieces on which we can use the basic model
%[text] - add up the instances of the basic model in the small pieces to get an approximation
%[text] - use integrals as the limiting value of the approximations to get an exact measure \
%[text] ## Basic Model: Point Masses and Gravity
%[text] In physics, the gravitational force between two **point masses** (m\_1) and (m\_2) is given by Newton's Law:
%[text]{"align":"center"} $\\vec{\\;F} =G\\;\\frac{m\_1 m\_2 }{{||\\vec{r} ||}^2 }\\hat{r}${"editStyle":"visual"}
%[text] where
%[text] - (G) is the universal gravitational constant,
%[text] - ($\\vec{r}${"editStyle":"visual"}) is the vector between the two masses
%[text] - ($\\hat{r}${"editStyle":"visual"}) is the unit vector pointing in the direction of $\\vec{r}${"editStyle":"visual"}. \
%[text] In single-variable cases this can be simplified to 
%[text]{"align":"center"} $F=G\\;\\frac{m\_1 m\_2 }{r^2 }${"editStyle":"visual"}
%[text] where r is the distance between the points.
%[text] Running this cell will give an animation of the gravity between two points (on a single variable axis) moving away from each other and plotting the resulting gravity attraction.
%[text] (Select "Run Section" to have the following cell produce an example animation.)
animate_two_masses()
%[text] You'll notice that the inverse square $\\frac{1}{r^2 }${"editStyle":"visual"} is what determines the gravity force in the case of two points separated by a single variable.
%[text] We will explore the gravity between a point and a solid, which will mean moving away from a single-variable case and into a vector scenario.
%%
%[text] #### **Challenges to the Basic Model: Point Mass and a Solid**
%[text] We want to calculate the force of gravity between a solid floating in space and a nearby point mass.
%[text] If the solid were itself a lumped point mass, the situation would be easy:
%[text] - Compute the distance from the point mass to the solid's center,
%[text] - Use Newton's formula. \
%[text] Unfortunately, many solids don't have exploitable symmetry, and so gravity acts between the cone and the point mass differently depending on where you are within the cone.
%[text] - Parts of the solid are closer, exerting stronger forces.
%[text] - Other parts are farther, exerting weaker forces.
%[text] - Variability in the solid shapes means a lack of symmetry.. \
%[text] You can see this clearly in the following plot, which visualizes the approximation of gravity attraction between a 1x1x1 cube of uniform density ${10}^{11} \\frac{\\textrm{kg}}{{\\mathrm{m}}^3 }${"editStyle":"visual"} against a point mass at (.5,.5,2) with mass 10kg. 
%[text] (NOTE: Since the constant G is very small ($6\\ldotp 6743\\times {10}^{-11}${"editStyle":"visual"}) we will assume all density values are scaled by ${10}^{11}${"editStyle":"visual"} for visibility and ease of numbers).
%[text] (Select "Run Section" to have the following cell produce the plot.)
plot_gravity_cube()
%[text] You should see a cube (broken up into pieces) and a red point mass with a mas value of 10.
%[text] # Reflection Questions
%[text] If you notice, the cube has a color gradient. 
%[text] The colors show the relative value of the various gravity calculations using Newton's formula. The cube has uniform density and is uniformly broken into pieces so all of the pieces have uniform mass.
%[text] Answer the following prompts:
%[text] - The color of each piece signifies the gravity approximation between the piece and the point mass, using the center of the cube for a measure of distance and the mass of the small piece. Given that the cube is uniformly dense, explain (using Newton's Law of Gravity) the color gradient shown in the plot.
%[text] - Why is the gravity smallest at the bottom of the cube?
%[text] - Why is the gravity greatest in the middle of the top of the cube, and then why does it decrease even along the top of the cube? \
%%
%[text] ## Gravity\* in Pieces: Building the Global Model
%[text] In this final project, you're going to approximate (and then exactly measure) the force of gravity\*\* between different shapes and a point mass.
%[text] \*\*At first, to ease our way into the calculations, we're going to work with the ***simplified setup*** $F=G\\;\\frac{m\_1 m\_2 }{r^2 }${"editStyle":"visual"}. At the end of the project there will be an optional opportunity to calculate gravity under the true setup $F=G\\;\\frac{m\_1 m\_2 }{{||\\vec{r} ||}^2 }\\hat{r}${"editStyle":"visual"}.
%[text] Under the ***simplified setup***, for each piece of the solid, we calcualte the distance between the center of the piece and the point mass. 
%[text] For each piece, we treat the mass of that piece as $m\_2${"editStyle":"visual"} in the formula $F=G\\;\\frac{m\_1 m\_2 }{r^2 }${"editStyle":"visual"}, and the mass of the point mass is $m\_1${"editStyle":"visual"}. The distance between them is given by $r${"editStyle":"visual"}.
%[text] Under this simplified setup, let's take a look at the cube gravity visualization again.
plot_gravity_cube_distances()
%[text] Notice that we've slightly increased the gravity approximation, and the distances between the pieces and the point mass are visualized instead of direction vectors.
%[text] This will be our working model for gravity for most of the project.
%%
%[text] ## Approximating Gravity for Various Shapes
%[text] First, let's examine the properties of a few shapes (densities, masses, gravities) to make sure we understand the physical process being modeled.
%[text] For the rest of the project, we will primarily use the function *generate\_solid\_gravity*
%[text] The function will take in a variety of settings and generate a plot of the gravity (in the true model or the simplified setup) between a solid (sphere, cone, cylinder) and the point mass under a variety of densities. 
%[text] The default setting is a sphere with a slightly skewed density, which impacts the gravity measurements. The default uses the simplified (over-approximation) model.
generate_solid_gravity();
%%
%[text] The *generate\_solid\_gravity* function outputs *densities* and *volumes* arrays, just like in the Module 7 activity. 
%[text] It also outputs *distances*, which gives the array of distances from the center of each piece to the point mass.
%[text] Remember that just like in *plot\_gravity\_cube*, you want to imagine small boxes around the points as the small pieces of the solids being used to approximate gravity with Newton's Law.
[densities, distances, volumes] = generate_solid_gravity();
%%
%[text] ## Approximating Gravity
%[text] We can use *densities*, *locations*, and *volumes* to approximate the gravity between the sphere and the point mass by computing the gravity between each piece and the point mass under Newton's Law.
%[text] Let's take a look at each to see what they represent.
%[text] First, remember that the plot you see breaks up the solid (a sphere) into many many pieces and plots a point in the center of that piece (cubes, for now). We **only** see the dots in the plot.
%[text] First, *densities* is the list of numbers representing the density of the object at the center of each piece
densities
%[text] You should see a 8217-long list of numbers. This means there are 8217 pieces of the sphere for this approximation.
%%
%[text] *volumes* is the list of numbers giving the volume of each piece.
volumes
%[text] We again see an 8217-long list of numbers. The rows of this list match the rows of densities, meaning that the ith row of densities is the density for the piece whose volume is also found at the ith row of volumes.
%%
%[text] Finally, *distances* is the 8217-long list of distances between the center of the piece and the point mass, which we will use for Newton's Law
distances
%[text] # Reflection Questions
%[text] Respond to the following:
%[text] - If the sphere had a uniform density, how would the coloring in the gravity plot be different?
%[text] - What must be true about the mass for the gravity plot to have the given coloring?
%[text] - Write out symbolically how the gravity (under the simplified setup) is approximated. Use $k${"editStyle":"visual"} to denote the index of the pieces (which are the rows of the *densities*, *locations*, and *volumes* arrays). \
%%
%[text] ## Newton's Law
%[text] Let's recreate Newton's law at a single piece before doing so at scale.
%[text] # Reflection Question
%[text] The first density is .62 (row 1 of *densities*), the distance from the first piece to the point mass (row 1 of *distances*) is 1.984, and the first *volume* is $\\ldotp 64\\times {10}^{-4}${"editStyle":"visual"}.
%[text] Using Newton's Law of Gravity, calculate the gravity attraction between the first piece and the point mass.
%[text] (NOTE: Use G=10 instead of Newton's Gravitational Constant for the sake of simplicity throughout the project)
%[text] (Hint: Remember also that the basic model for mass is $\\textrm{mass}=\\textrm{density}\*\\textrm{volume}${"editStyle":"visual"})

%[text] You should get .001 as the gravity measure for piece 1.
%%
%[text] ## Approximating Gravity: Adding Up Small Gravities
%[text] As with all integration problems, we solve the "multiplying doesn't work" problem by:
%[text] 1. breaking up an object into small pieces
%[text] 2. make the desired measurement on each small piece
%[text] 3. add up all of the small measurements to get a global measurement \
%[text] The function *generate\_solid\_gravity* completes step 1 for you, giving you the lists of densities, distances, and volumes. 
%[text] Now, you complete steps 2 and 3. We can use MATLAB to measure gravity at each piece simultaneously using the operations +, -, .\*, ./ and .^ as addition, subtraction, multiplciation, division, and exponentiation of all elements in the arrays at once.
%[text] Recreate Newton's Law of Gravity using these operations and the *distances, densities, volumes* arrays to make an array called *gravities* that represents the gravity pull between each piece and the point mass.

%%
%[text] Now, use the *sum* command to complete step 3, adding up all of the gravities to make an approximate gravity (simple setup) for the whole object.

%[text] You should see the same number as shown in the plot from *generate\_solid\_gravity*.
%[text] # Reflection Questions
%[text] You've just used MATLAB to carry out quickly a "midpoint" Riemann Sum on the volume elements. Do the following: 
%[text] - Write out symbolically what MATLAB has done using summation notation, using $\\Delta M\_k ,\\Delta V\_k ,\\Delta F\_k${"editStyle":"visual"} for the mass, volume, gravity (respectively) of each piece of the solid as necessary. You can combine your answer here to the similar previous reflection question.
%[text] - How do we make this approximation more precise? What do we do to the sum to get an exact measure of gravity (simple setup) and how does that connect to definite integration? \
%%
%[text] # **Almost Your Turn: Calculating Exact Gravity (Simple Setup)**
%[text] We've gone through the process of setting up (using the ***simple setup***) the Riemann Sum approximation of gravity between the solid and the point mass. 
%[text] Now, you will receive your own personal solid, go through a simliar process to calculate the gravity approximation in MATLAB, and then use a triple integral to get the exact measure of gravity (under the simple setup) between the solid and the point mass.
%[text] ### Review
%[text] If we take $r${"editStyle":"visual"} to represent the distance between the piece of the solid (measured at the center of the small piece) and the point mass, we can use Newton's law to measure the small addition of force we get for that section of the solid, $\\Delta F${"editStyle":"visual"}. 
%[text] $\\Delta \\;F\_i \\approx \\frac{Gm\\;\\Delta M\_i }{{r\_i }^2 }${"editStyle":"visual"}
%[text] The subscript $i${"editStyle":"visual"} just means that it's an individual piece amongst N pieces. $G${"editStyle":"visual"} is Newton's gravitational constant (we're using G=10 purely for visual and numerical ease), $m${"editStyle":"visual"} is the mass of the point mass, and $\\Delta M\_i${"editStyle":"visual"} is the mass of the small piece.
%[text] Adding them up gives an approximation of gravity
%[text] $F\\approx \\sum\_{i=1}^N \\Delta F\_i =\\sum\_{i=1}^N \\frac{Gm\\;\\Delta M\_i \\;}{r\_i^2 }${"editStyle":"visual"}
%[text] As (N) grows, this gets closer to the true gravitational force, since the pieces will shrink in size and the point-mass assumption will yield less error.
%%
%[text] ### Possible Shapes
%[text] Next we'll generate your personal shape using your Student ID. This will be the shape you use for the rest of the project.
%[text] First, let's get a brief glimpse of the potential shapes you're working with.
%[text] (Select "Run Section" to have the following cell produce three example shapes and points.)
generate_student_solid(1);
generate_student_solid(4);
generate_student_solid(7);
%[text] You'll notice that the possible shapes are a sphere, a cone, and a cylinder.
%[text] The density function, shape parameter information, and point mass information are all printed out above the plot for you to work with, but there are two very important things for you to observe:
%[text] 1. The solids are not plotted in cartesian coordinates, they are given in either cylindrical or spherical coordinates.
%[text] 2. The density function is given in cartesian coordiantes. \
%[text] You will need to write out and calculate a triple integral that computes the gravity between the solid and the point mass. The easiest way to do this is to work in the appropriate coordinate system for the shape. We have given density functions $\\begin{array}{l}\n\\rho \\\\\n\n\\end{array}${"editStyle":"visual"} that should not yield too difficult conversions to the appropriate coordinate systems, nor require too difficult antiderivatives.
%[text] # Reflection Question
%[text] Based on the gravity plots, answer the following: (Hint, the "pieces" in spherical coordinates and cylindrical coordinates are not necesarily the same size).
%[text] - Why is the top center of the sphere colored blue? Those points are theoreticlaly closer to the point than others, so why is the gravity calculation so low?
%[text] - Similarly, why is the top of the cone colored blue?
%[text] - Explain the shapes of the solids (Hint: Think about the coordinate system) \
%%
%[text] # Your Turn
%[text] Now let's give you the specific shape, point, and density that you'll use to finish out the project.
%[text] Replace 12345 with your student ID in *generate\_student\_solid*
[densities, distances, volumes] = generate_student_solid(12345)
%[text] You should see a sphere, cone, or cylinder as before as well as a point mass.
%[text] You should also see:
%[text] - a printout of the density function (given in cartesian coordinates), 
%[text] - the center of the solid (or the center of the base for a cylinder or cone), 
%[text] - the parameters of the solid, 
%[text] - the point mass location and its mass. \
%[text] Your job is to approximate the gravity between the solid and the point mass (under the simplified setup of gravity) and then use a triple integral to calcualte its exact value.
%%
%[text] First, you'll want to get an approximation of the mass, as you've done before in previous sections. Even though the solid is set up in a non-cartesian coordinate system, assume all values from *densities*, *distances*, and *volumes* are with respect to the Cartesian coordinate system.
%[text] (Remember we're using the value G=10 for Newton's gravitational constant instead of the actual value $6\\ldotp 674\\times {10}^{-11}${"editStyle":"visual"})
G=10;
%[text] Now recreate Newton's calculation of gravity between each piece of the solid and the point mass, using MATLAB.

%[text] Remember this value as a check against what you calcualte for the gravity using triple integrals.
%[text] # Reflection Question
%[text] Answer the following:
%[text] - Why can't we just use Newton's Law of Gravity\*\*\* to calcualte the exact gravity between the solid and the point mass for these solids?
%[text] - Why is there error in our approximation method after we break up the solid into pieces? \
%[text] \*\*\*Technically for the sphere we actually can just use Newton's Law of Gravity, but if you have a sphere talk about why we can't do this for *all* shapes.
%%
%[text] ## Using Integrals to Get an Exact Measure
%[text] The methods you learned in the textbook to compute triple integrals is how you can leverage the Fundamental Theorem of Calculus to find exact formulas that quickly give you the measure of gravity calculated by a volume sum. 
%[text] That is,
%[text]{"align":"center"} $F\\approx \\sum\_k \\Delta F\_k =\\sum\_k \\frac{{\\textrm{Gm}}\_1 \\Delta M\_k }{r\_k^2 }${"editStyle":"visual"}
%[text] Using triple integrals, we can write this exact measure of gravity as 
%[text]{"align":"center"} $F=\\int \\int \\int \\textrm{dF}=\\int \\int \\int \\frac{{\\textrm{Gm}}\_1 \\textrm{dM}}{r^2 }${"editStyle":"visual"}
%[text] Luckily, from our previous work we know how to formulate the differential for mass, and with respect to each coordinate system we also know how to formulate the differential for volume $\\textrm{dV}${"editStyle":"visual"}.
%[text] Put this information together into a triple integral and **write in your report** the triple integral (including the bounds) that should calcualte the gravity between your solid and the point mass.
%[text] NOTE: 
%[text] - This is not in your reflection questions so feel free to get help from each other and from the instructor.
%[text] - The bounds of integration are going to matter here, and so you need to attend to all parameters of the shape including the "center" given.
%[text] - You'll need to think about the geometry a little bit to know how to set up the distances $r${"editStyle":"visual"} between the differential pieces and the point mass.
%[text] - You will compute the measure given by the integral next in the Reflection Questions, so don't discuss the solution to the integral in the Help Forum. \
%%
%[text] # Reflection Questions
%[text] Using your personal gravity-computing integral:
%[text] - What is the gravity (under the simple setup) between the solid and the point mass?
%[text] - Work out by hand the steps to use the FTC to compute the integral measure
%[text] - Verify in MATLAB (using three int() commands) the measure you found.
%[text] - Does the measure you found using integration closely match the approximation?
%[text] - Describe how you should think about integration as it applies to STEM after you leave calculus. \

%%
%[text] # (Optional) The True Setup for Measuring Gravity
%[text] As we mentioned in the introduction, the true way to measure gravity between two point masses is with the following computation (Newton's Law of Gravity)
%[text]{"align":"center"} $\\vec{\\;F} =G\\;\\frac{m\_1 m\_2 }{{||\\vec{r} ||}^2 }\\hat{r}${"editStyle":"visual"}
%[text] where
%[text] - (G) is the universal gravitational constant,
%[text] - ($\\vec{r}${"editStyle":"visual"}) is the vector between the two masses
%[text] - ($\\hat{r}${"editStyle":"visual"}) is the unit vector pointing in the direction of $\\vec{r}${"editStyle":"visual"}. \
%[text] We need to work with vectors because of the symmetry in objects. That is, in a situation like the following
plot_gravity_cube()
%[text] the vectors $\\vec{\\;F}${"editStyle":"visual"} representing the gravitational pull will have some cancellation "horizontally" since they are all oriented towards the single point mass.
%%
%[text] To truly approximate gravity, then, we need to add together all of the force vectors $\\vec{\\;F\_k }${"editStyle":"visual"} to make a single net force vector $\\vec{\\;F}${"editStyle":"visual"}.
%[text]{"align":"center"} $\\vec{\\;F} \\approx \\sum\_k \\;\\vec{\\;F\_k } =\\sum\_k \\;G\\;\\frac{m\_1 m\_2 }{{||\\vec{r} ||}^2 }\\hat{r}${"editStyle":"visual"}
%[text]{"align":"center"} 
%[text] This would look something like the following, where the first plot is all of the vectors $\\vec{\\;F\_k }${"editStyle":"visual"} and the second plot is the final approximate vector $\\vec{\\;F}${"editStyle":"visual"}.
generate_solid_gravity('arrow_mode','all');
generate_solid_gravity('gravity_mode','true','arrow_mode','net');
%[text] The simplified model overestimates the gravity by adding up the magnitudes of all of the small vectors ***before*** taking into account the cancellation that occurs to make the final vector.
%[text] So the true measure of gravity is $||\\vec{\\;F} ||${"editStyle":"visual"}.
%%
%[text] We can approximate this true gravity by summing all of the force vectors together using Newton's Law of Gravity and then ending by taking the magnitude of the resulting vector.
%[text] Using 'gravity\_mode' as 'true' outputs an Nx3 matrix whose rows are the vectors for the gravity of each element, rather than just calculating the distances from the points to the point mass.
[densities, gravity_vectors, volumes] = generate_solid_gravity('gravity_mode','true','n',100)
%[text] These already computed Newton's Law of Gravity at each point, so the matrix is the list of vectors 
%[text]{"align":"center"} $\\vec{\\;F\_k } =G\\;\\frac{m\_1 m\_2 }{{||\\vec{r\_k } ||}^2 }\\hat{\\;r\_k }${"editStyle":"visual"}
%[text] To get the approximation of gravity, you make a single gravity vector $\\vec{\\;F} \\approx \\sum\_k \\vec{\\;F\_k }${"editStyle":"visual"} and find the norm $||\\vec{\\;F} ||${"editStyle":"visual"}.
%[text] If you use *sum* on a matrix with *1* as the second argument, the sum will only add up the values across the columns. So this will make a 3-dimensional vector whose components are the sums of the components of *gravity\_vectors*
%[text] You can then find the norm of that vector.
%[text] Confirm the calculation of the true gravity approximation using *gravity\_vectors*

%%
%[text] We can verify that this is the true gravity in the case of the sphere because for two spheres Newton's Law actually applies, even in the basic model. So if we find the mass of the sphere (using *densities* and *volumes*) all we would need is Newton's basic law (even the simplified version) to calcualte the gravity.
%[text] Use *densities* and *volumes* to verify this. (Note: The point is at \[.5, .5, 2\] with a mass of 10. The center of the sphere is \[.5, .5, .5\].

%[text] Note that there is still a little error (but not much) because we are merely approximating the true gravity.
%[text] If we wanted to get an *exact* measure of the true gravity, we would need to use three triple integrals to generate the vector $\\vec{\\;F}${"editStyle":"visual"}, one for each component.
%[text]{"align":"center"} 

%[appendix]{"version":"1.0"}
%---
%[metadata:view]
%   data: {"layout":"onright","rightPanelPercent":43.5}
%---
